<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»å…¸ Flash æ¸¸æˆåº“ - heifengzhaikengwang</title>
    
    <!-- åŸºç¡€è·¯å¾„å£°æ˜ (å…³é”®ä¿®å¤) -->
    <base href="https://heifengzhaikengwang.github.io/">
    
    <!-- ä¼˜å…ˆåŠ è½½ Ruffle æ ¸å¿ƒæ–‡ä»¶ -->
    <script src="ruffle.js"></script>

    <!-- å¼ºåŒ–é…ç½®éªŒè¯ -->
    <script>
        (function() {
            // å¼ºåˆ¶åˆå§‹åŒ–æ£€æŸ¥
            if (!window.RufflePlayer) {
                console.error("[è‡´å‘½é”™è¯¯] RufflePlayer å…¨å±€å¯¹è±¡æœªå®šä¹‰");
                showError("Ruffle æ ¸å¿ƒåº“åŠ è½½å¤±è´¥");
                return;
            }

            // ç²¾ç¡®è·¯å¾„é…ç½®
            window.RufflePlayer.config = Object.freeze({
                publicPath: document.baseURI,  // åŠ¨æ€è·å–åŸºç¡€è·¯å¾„
                polyfills: true,
                autoplay: "on",
                logLevel: "debug",
                compatibilityChecks: true
            });

            // ç‰ˆæœ¬å…¼å®¹æ€§éªŒè¯
            try {
                if (typeof window.RufflePlayer.newest !== 'function') {
                    throw new Error("RufflePlayer.newest() æ–¹æ³•ä¸å¯ç”¨");
                }
                console.info("Ruffle æ ¸å¿ƒæ¨¡å—éªŒè¯é€šè¿‡");
            } catch (error) {
                console.error("Ruffle åˆå§‹åŒ–å¤±è´¥:", error);
                showError(error.message);
            }
        })();

        // ç»Ÿä¸€é”™è¯¯å¤„ç†
        function showError(message) {
            const container = document.getElementById('player-container');
            if (container) {
                container.innerHTML = `
                    <div style="padding: 2rem; background: #ffeef0; border-radius: 8px;">
                        <h2 style="color: #cf222e;">âš ï¸ ç³»ç»Ÿé”™è¯¯</h2>
                        <p>${message}</p>
                        <h3>è¯Šæ–­æŒ‡å—ï¼š</h3>
                        <ol>
                            <li>è®¿é—® <a href="/ruffle.js" target="_blank">ruffle.js</a> éªŒè¯æ–‡ä»¶å­˜åœ¨</li>
                            <li>æ£€æŸ¥æ§åˆ¶å° Network æ ‡ç­¾çš„åŠ è½½çŠ¶æ€</li>
                            <li>å¼ºåˆ¶åˆ·æ–°é¡µé¢ <button onclick="location.reload()" style="padding: 4px 8px;">â†»</button></li>
                        </ol>
                        <p style="margin-top: 1rem; color: #666;">
                            æŠ€æœ¯ä¿¡æ¯ï¼š${navigator.userAgent}
                        </p>
                    </div>
                `;
            }
        }
    </script>

    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e74c3c;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            padding: 3rem 0;
            background: linear-gradient(135deg, var(--primary), #34495e);
            color: white;
            border-radius: 16px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        #player-container {
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
            margin: 2rem 0;
            position: relative;
            min-height: 600px;
        }

        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 48px;
            height: 48px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ® ç»å…¸æ¸¸æˆæ¡£æ¡ˆé¦†</h1>
        <p>Ruffle æŠ€æœ¯é©±åŠ¨ | æ°¸ä¹…ä¿å­˜ Flash é—äº§</p>
    </div>

    <div id="player-container">
        <div class="loader"></div>
    </div>

    <script>
        // å®‰å…¨åˆå§‹åŒ–æµç¨‹
        function initializePlayer() {
            try {
                const ruffle = window.RufflePlayer.newest();
                const container = document.getElementById('player-container');
                
                // åˆ›å»ºæ’­æ”¾å™¨å®ä¾‹
                const player = ruffle.createPlayer();
                player.style.cssText = `
                    width: 100%;
                    height: 600px;
                    background: #000;
                `;
                
                // æ¸…ç©ºå®¹å™¨å¹¶æ³¨å…¥æ’­æ”¾å™¨
                container.innerHTML = '';
                container.appendChild(player);

                // åŠ è½½æ¸¸æˆå†…å®¹
                player.load('game.swf')
                    .then(() => console.log('SWF åŠ è½½æˆåŠŸ'))
                    .catch(e => {
                        console.error('SWF åŠ è½½å¤±è´¥:', e);
                        showError(`æ¸¸æˆåŠ è½½å¤±è´¥: ${e.message}`);
                    });

            } catch (error) {
                console.error('æ’­æ”¾å™¨åˆå§‹åŒ–å¼‚å¸¸:', error);
                showError(error.message);
            }
        }

        // å¯åŠ¨æ‰§è¡Œ
        if (document.readyState === 'complete') {
            initializePlayer();
        } else {
            window.addEventListener('load', initializePlayer);
        }
    </script>
</body>
</html>
