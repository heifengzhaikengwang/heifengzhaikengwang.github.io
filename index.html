<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- 保持原有head部分不变 -->
    <!-- ... -->
</head>
<body>
    <h1>地震避险互动小游戏</h1>
    <div class="container">
        <div id="ruffle-container"></div>
        <p class="notice">如果无法加载游戏，请尝试更新浏览器或使用最新版Chrome/Firefox浏览器</p>
    </div>

    <script>
        // 配置Ruffle使用本地文件
        window.RufflePlayer = {
            config: {
                // 指向仓库内的本地文件
                publicPath: "/",
                // 安全策略配置
                allowScriptAccess: false,
                allowNetworking: "all",
                openUrlMode: "deny",
                // 加载参数
                autoplay: "auto",
                backgroundColor: "#FFFFFF",
                scale: "showAll",
                warnOnUnsupportedContent: false
            }
        };

        // 动态加载本地ruffle文件
        (function() {
            const ruffleScript = document.createElement('script');
            ruffleScript.src = '/ruffle.js';
            document.head.appendChild(ruffleScript);
        })();

        // 初始化播放器
        window.addEventListener("DOMContentLoaded", () => {
            const initPlayer = () => {
                if (!window.RufflePlayer?.newest) {
                    setTimeout(initPlayer, 50);
                    return;
                }

                const container = document.getElementById("ruffle-container");
                const ruffle = window.RufflePlayer.newest();
                const player = ruffle.createPlayer();
                
                // 添加缓存清除参数
                const swfUrl = "/game.swf?t=" + Date.now();
                
                // 设置播放器属性
                player.style.width = "100%";
                player.style.height = "100%";
                container.appendChild(player);

                // 加载SWF文件
                player.load(swfUrl)
                    .catch((error) => {
                        console.error("加载失败:", error);
                        container.innerHTML = `<p>加载错误：${error.status || 500}</p>`;
                        // 备用方案：尝试重新加载
                        setTimeout(() => player.load(swfUrl), 2000);
                    });
            };
            initPlayer();
        });
    </script>
</body>
</html>
