<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>SWF直连加载方案</title>
    <style>
        body {
            margin: 0;
            background: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        #player-container {
            width: 800px;
            height: 600px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div id="player-container"></div>

    <!-- 锁定Ruffle核心版本 -->
    <script src="https://unpkg.com/@ruffle-rs/ruffle@0.1.0-nightly.2024.4.18/ruffle.js"></script>

    <script>
        // 强制配置SWF绝对路径
        const SWF_ABSOLUTE_URL = 'https://heifengzhaikengwang.github.io/game.swf';

        async function loadSWF() {
            try {
                // 阶段1：验证Ruffle加载
                if (!window.RufflePlayer) {
                    throw new Error("Ruffle核心加载失败");
                }

                // 阶段2：创建播放器实例
                const player = window.RufflePlayer.newest().createPlayer();
                document.getElementById("player-container").appendChild(player);

                // 阶段3：强制使用绝对路径加载
                await player.load({
                    url: SWF_ABSOLUTE_URL,
                    allowScriptAccess: true,
                    parameters: {
                        quality: "best",
                        scale: "exactFit",
                        wmode: "direct"
                    }
                });

                console.log('SWF加载指令已发送');

            } catch (error) {
                console.error('致命错误:', error);
                alert(`加载失败：${error.message}\n完整路径：${SWF_ABSOLUTE_URL}`);
            }
        }

        // 添加容错加载机制
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(loadSWF, 500); // 添加延迟确保Ruffle初始化
        });
    </script>
</body>
</html>
