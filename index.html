<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»å…¸ Flash æ¸¸æˆåº“ - heifengzhaikengwang</title>
    
    <!-- æ ¸å¿ƒæ–‡ä»¶åŠ è½½ -->
    <script src="./ruffle.js"></script> <!-- æ˜¾å¼ç›¸å¯¹è·¯å¾„ -->

    <!-- é…ç½®ä¸åˆå§‹åŒ– -->
    <script>
        // å¼ºåŒ–é…ç½®éªŒè¯
        (function() {
            if (!window.RufflePlayer) {
                console.error("RufflePlayer å…¨å±€å¯¹è±¡æœªå®šä¹‰");
                return;
            }

            // ç²¾ç¡®é…ç½®å‚æ•°
            window.RufflePlayer.config = Object.freeze({
                publicPath: new URL("./", window.location.href).href, // åŠ¨æ€è®¡ç®—è·¯å¾„
                polyfills: true,
                autoplay: "on",
                logLevel: "warn",
                compatibilityChecks: true
            });

            // ç‰ˆæœ¬éªŒè¯
            if (typeof window.RufflePlayer.newest !== 'function') {
                console.error("RufflePlayer.newest ä¸æ˜¯æœ‰æ•ˆå‡½æ•°");
                console.debug("å½“å‰ RufflePlayer å¯¹è±¡:", window.RufflePlayer);
            }
        })();
    </script>

    <style>
        /* ä¿æŒåŸæœ‰æ ·å¼ä¸å˜ */
    </style>
</head>
<body>
    <!-- ä¿æŒåŸæœ‰ DOM ç»“æ„ä¸å˜ -->

    <script>
        // å¼ºåŒ–åˆå§‹åŒ–æµç¨‹
        function initRuffle() {
            try {
                // ä¸‰çº§éªŒè¯æœºåˆ¶
                if (!window.RufflePlayer) throw Error("RufflePlayer æœªå®šä¹‰");
                if (!window.RufflePlayer.newest) throw Error("newest() æ–¹æ³•ç¼ºå¤±");
                
                const ruffle = window.RufflePlayer.newest();
                const container = document.getElementById('player-container');
                
                // å®¹å™¨å­˜åœ¨æ€§æ£€æŸ¥
                if (!container) throw Error("æ’­æ”¾å™¨å®¹å™¨æœªæ‰¾åˆ°");

                const player = ruffle.createPlayer();
                player.style.cssText = "width:100%;height:600px;";
                container.innerHTML = '';
                container.appendChild(player);

                // å¼‚æ­¥åŠ è½½æµ‹è¯•
                player.load('game.swf').then(() => {
                    console.log("SWF åŠ è½½æˆåŠŸ");
                }).catch(e => {
                    console.error("SWF åŠ è½½å¤±è´¥:", e);
                });

            } catch (error) {
                const errorHtml = `
                    <div style="color:#dc3545; padding:2rem; text-align:center;">
                        <h3>ğŸš¨ ä¸¥é‡é”™è¯¯</h3>
                        <p>${error.message}</p>
                        <div style="margin-top:1rem;">
                            <button onclick="location.reload()" style="padding:0.5rem 1rem; background:#007bff; color:white; border:none; border-radius:4px;">
                                é‡æ–°åŠ è½½
                            </button>
                        </div>
                        <div style="margin-top:1rem; font-size:0.9em;">
                            <p>æŠ€æœ¯ä¿¡æ¯ï¼š</p>
                            <ul style="text-align:left; list-style:none;">
                                <li>Ruffle ç‰ˆæœ¬: ${window.RufflePlayer?.version || 'æœªçŸ¥'}</li>
                                <li>æ ¸å¿ƒæ–‡ä»¶çŠ¶æ€: ${checkFileStatus()}</li>
                            </ul>
                        </div>
                    </div>
                `;
                document.getElementById('player-container').innerHTML = errorHtml;
            }
        }

        // æ–‡ä»¶çŠ¶æ€æ£€æŸ¥
        function checkFileStatus() {
            return [
                { name: 'ruffle.js', path: './ruffle.js' },
                { name: 'æ ¸å¿ƒæ¨¡å—', path: './core.ruffle.6434870f3ba01171ffe8.js' },
                { name: 'WASM æ–‡ä»¶', path: './ruffle.wasm' }
            ].map(file => {
                try {
                    new URL(file.path, window.location.href);
                    return `<li>${file.name}: âœ… è·¯å¾„æœ‰æ•ˆ</li>`;
                } catch {
                    return `<li>${file.name}: âŒ è·¯å¾„æ— æ•ˆ</li>`;
                }
            }).join('');
        }

        // å®‰å…¨å¯åŠ¨
        if (document.readyState === 'complete') {
            initRuffle();
        } else {
            window.addEventListener('load', initRuffle);
        }
    </script>
</body>
</html>
